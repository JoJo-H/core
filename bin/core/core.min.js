var __reflect=this&&this.__reflect||function(t,e,o){t.__class__=e,o?o.push(e):o=[e],t.__types__=t.__types__?o.concat(t.__types__):o},__extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);o.prototype=e.prototype,t.prototype=new o},core;!function(t){var e=function(){function e(){}return e.getModDo=function(e){return t.is.string(e)?e:e&&e.moddo?e.moddo:null},e.BeforeChange=function(t){return"BeforeChange."+e.getModDo(t)},e.AfterChange=function(t){return"AfterChange."+e.getModDo(t)},e.Change=function(t){return"Change."+e.getModDo(t)},e.Cache=function(t){return"Cache."+e.getModDo(t)},e.CacheChange="CacheChange",e}();t.NotificationKey=e,__reflect(e.prototype,"core.NotificationKey"),t.k=e}(core||(core={}));var core;!function(t){var e=function(){function t(t,e,o){void 0===e&&(e=null),void 0===o&&(o=null),this.name=null,this.body=null,this.type=null,this.name=t,this.body=e,this.type=o}return t.prototype.getName=function(){return this.name},t.prototype.setBody=function(t){this.body=t},t.prototype.getBody=function(){return this.body},t.prototype.setType=function(t){this.type=t},t.prototype.getType=function(){return this.type},t.prototype.toString=function(){var t="Notification Name: "+this.getName();return t+="\nBody:"+(null==this.getBody()?"null":this.getBody().toString()),t+="\nType:"+(null==this.getType()?"null":this.getType())},t}();t.Notification=e,__reflect(e.prototype,"core.Notification",["core.INotification"])}(core||(core={}));var core;!function(t){var e=function(){function t(e){void 0===e&&(e=null),this.mediatorName=null,this.mediatorName=null!=e?e:t.NAME}return t.prototype.getMediatorName=function(){return this.mediatorName},t.prototype.listNotificationInterests=function(){return[]},t.prototype.handleNotification=function(t){},t.prototype.onRegister=function(){},t.prototype.onRemove=function(){},t.NAME="Mediator",t}();t.Mediator=e,__reflect(e.prototype,"core.Mediator",["core.IMediator"])}(core||(core={}));var core;!function(t){var e=function(t){function e(o,r){void 0===o&&(o=null),void 0===r&&(r=null);var n=t.call(this)||this;return n._proxyName=null,n._data=null,n._proxyName=null!=o?o:e.NAME,null!=r&&n.setData(r),n}return __extends(e,t),e.prototype.getProxyName=function(){return this._proxyName},e.prototype.setData=function(t){this._data=t},e.prototype.getData=function(){return this._data},e.prototype.onRegister=function(){},e.prototype.onRemove=function(){},e.NAME="Proxy",e}(egret.EventDispatcher);t.Model=e,__reflect(e.prototype,"core.Model",["core.IModel"])}(core||(core={}));var core;!function(t){function e(e){t.singleton(_).registerMediator(e)}function o(e){t.singleton(_).retrieveMediator(e)}function r(e){t.singleton(_).hasMediator(e)}function n(e){t.singleton(_).removeMediator(e)}function i(e){t.singleton(_).registerModel(e)}function s(e){t.singleton(_).retrieveModel(e)}function a(e){t.singleton(_).hasModel(e)}function c(e){t.singleton(_).removeModel(e)}function u(e,o,r,n){void 0===n&&(n=0),t.singleton(_).registerObserver(e,new t.Observer(o,r,n))}function f(e,o,r){void 0===o&&(o=null),void 0===r&&(r=null),t.singleton(_).notifyObservers(new t.Notification(e,o,r))}function p(e,o){t.singleton(_).removeObserver(e,o)}function l(e){t.singleton(_).removeObserverByName(e)}function h(e){t.singleton(_).removeObserverByContext(e)}function y(e,o){return t.singleton(_).checkObserver(e,o)}var _=function(){function e(){if(this._observerMap=null,this._mediatorMap=null,this._modelMap=null,e._instance)throw Error("MVCSystem singleton already constructed!");e._instance=this,this._observerMap={},this._mediatorMap={},this._modelMap={}}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.registerMediator=function(e){var o=e.getMediatorName();if(!this._mediatorMap[o]){this._mediatorMap[o]=e;var r=e.listNotificationInterests(),n=r.length;if(n>0)for(var i=new t.Observer(e.handleNotification,e),s=0;n>s;s++)this.registerObserver(r[s],i);e.onRegister()}},e.prototype.retrieveMediator=function(t){return this._mediatorMap[t]||null},e.prototype.removeMediator=function(t){var e=this._mediatorMap[t];if(!e)return null;for(var o=e.listNotificationInterests(),r=o.length;r--;)this.removeObserver(o[r],e);return delete this._mediatorMap[t],e.onRemove(),e},e.prototype.hasMediator=function(t){return null!=this._mediatorMap[t]},e.prototype.registerModel=function(t){var e=t.getProxyName();this._modelMap[e]||(this._modelMap[e]=t,t.onRegister())},e.prototype.removeModel=function(t){var e=this._modelMap[t];return e&&(delete this._modelMap[t],e.onRemove()),e},e.prototype.retrieveModel=function(t){return this._modelMap[t]||null},e.prototype.hasModel=function(t){return null!=this._modelMap[t]},e.prototype.registerObserver=function(t,e){var o=this._observerMap[t];o&&o.length>0?this.checkObserver(t,e.getNotifyContext())?console.warn("registerObserver重复注册:",t):(o.push(e),o.sort(function(t,e){return e.getPriority()-t.getPriority()})):this._observerMap[t]=[e]},e.prototype.checkObserver=function(t,e){for(var o=this._observerMap[t],r=o.length,n=0;r>n;n++){var i=o[n];if(i.compareNotifyContext(e))return!0}return!1},e.prototype.notifyObservers=function(t){var e=t.getName(),o=this._observerMap[e];if(o)for(var r=o.slice(0),n=r.length,i=0;n>i;i++){var s=r[i];s.notifyObserver(t)}},e.prototype.removeObserver=function(t,e){var o=this._observerMap[t];if(o)for(var r=o.length;r--;){var n=o[r];if(n.compareNotifyContext(e)){o.splice(r,1);break}}},e.prototype.removeObserverByName=function(t){this._observerMap[t]=[]},e.prototype.removeObserverByContext=function(t){for(var e in this._observerMap)this.removeObserver(e,t)},e}();__reflect(_.prototype,"MVCSystem"),t.registerMediator=e,t.retrieveMediator=o,t.hasMediator=r,t.removeMediator=n,t.registerModel=i,t.retrieveModel=s,t.hasModel=a,t.removeModel=c,t.addNotification=u,t.sendNotification=f,t.removeNotification=p,t.removeNotificationByName=l,t.removeNotificationByContext=h,t.hasNotification=y}(core||(core={}));var core;!function(t){var e=function(){function t(){if(this._cacheData=null,t.instance)throw Error("ProxyCache singleton already constructed!");t._instance=this,this._cacheData={}}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.getCache=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=null),null==t)return this._cacheData;if(this.isCache(t,e)){var o=this.formatParmas(t,e);return this._cacheData[o[0]][o[1]]}return null},t.prototype.formatParmas=function(t,e){if(void 0===e&&(e=null),null==e){var o=t.split(".");t=o[0],e=o[1]}return[t,e]},t.prototype.isCache=function(t,e){void 0===e&&(e=null);var o=this.formatParmas(t,e);return this._cacheData.hasOwnProperty(o[0])&&this._cacheData[o[0]].hasOwnProperty(o[1])},t._instance=null,t}();__reflect(e.prototype,"ProxyCache")}(core||(core={}));var core;!function(t){var e=function(){function t(t,e,o){void 0===o&&(o=0),this._notifyMethod=null,this._context=null,this._priority=0,this.setNotifyMethod(t),this.setNotifyContext(e),this.setPriority(o)}return t.prototype.getNotifyMethod=function(){return this._notifyMethod},t.prototype.setNotifyMethod=function(t){this._notifyMethod=t},t.prototype.getNotifyContext=function(){return this._context},t.prototype.setNotifyContext=function(t){this._context=t},t.prototype.getPriority=function(){return this._priority},t.prototype.setPriority=function(t){this._priority=t},t.prototype.notifyObserver=function(t){this.getNotifyMethod().call(this._context,t)},t.prototype.compareNotifyContext=function(t){return this._context==t},t}();t.Observer=e,__reflect(e.prototype,"core.Observer",["core.IObserver"])}(core||(core={}));var core;!function(t){var e=function(){function t(){}return t.truthy=function(t){return this.existy(t)&&t!==!1&&!this.nan(t)&&""!==t&&0!==t},t.falsy=function(t){return!this.truthy(t)},t.existy=function(t){return null!==t&&void 0!==t},t.undefined=function(t){return void 0===t},t.nan=function(t){return t!==t},t.nul=function(t){return null===t},t.number=function(e){return!this.nan(e)&&"[object Number]"===t.toString.call(e)},t.object=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},t.fun=function(e){return"[object Function]"===t.toString.call(e)||"function"==typeof e},t.array=function(e){return Array.isArray(e)||"[object Array]"===t.toString.call(e)},t.bool=function(e){return e===!0||e===!1||"[object Boolean]"===t.toString.call(e)},t.date=function(e){return"[object Date]"===t.toString.call(e)},t.regexp=function(e){return"[object RegExp]"===t.toString.call(e)},t.string=function(e){return"[object String]"===t.toString.call(e)},t["char"]=function(t){return this.string(t)&&1===t.length},t.even=function(t){return this.number(t)&&t%2===0},t.odd=function(t){return this.number(t)&&t%2===1},t.decimal=function(t){return this.number(t)&&t%1!==0},t.integer=function(t){return this.number(t)&&t%1===0},t.toString=Object.prototype.toString,t}();t.is=e,__reflect(e.prototype,"core.is")}(core||(core={}));var core;!function(t){var e=function(){function e(t){this._leftArr=[],this._useArr=[],this._type=t}return e.prototype.push=function(e){var o=this._useArr.indexOf(e);if(-1!=o){var r=this._useArr[o];t.is.fun(r.dispose)&&r.dispose(),this._useArr.splice(o,1)}-1==this._leftArr.indexOf(e)&&this._leftArr.push(e)},e.prototype.pop=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];if(0==this._leftArr.length){var r=new this._type;this._leftArr.push(r)}var n=this._leftArr.shift();return t.is.fun(n.init)&&n.init.apply(n,e),this._useArr.push(n),n},e}();__reflect(e.prototype,"ObjectPool");var o=function(){function t(){}return t.getPool=function(t){var o=t.name,r=Symbol["for"](o);return this._poolMap.has(r)||this._poolMap.set(r,new e(t)),this._poolMap.get(r)},t.getTypePool=function(t,o){var r=o+t.name,n=Symbol["for"](r);return this._poolMap.has(n)||this._poolMap.set(n,new e(t)),this._poolMap.get(n)},t._poolMap=new Map,t}();__reflect(o.prototype,"pool")}(core||(core={}));var core;!function(t){function e(t){var e=t.name,o=Symbol["for"](e);return this._singletonMap.hasOwnProperty(o)||(this._singletonMap[o]=new t),this._singletonMap[o]}function o(t,e){var o=e+t.name,r=Symbol["for"](o);return this._singletonMap.hasOwnProperty(r)||(this._singletonMap[r]=new e),this._singletonMap[r]}t.singleton=e,t.typeSingleton=o}(core||(core={}));var core;!function(t){function e(t){return t.hasOwnProperty(this._type_key_name)||(t[this._type_key_name]=this._type_id_++),t[this._type_key_name]}function o(t){return t&&t.hasOwnProperty(this._type_key_name)}t.getTypeId=e,t.hasTypeId=o}(core||(core={}));